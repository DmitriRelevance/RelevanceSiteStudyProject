@page "/logout"
@using Microsoft.AspNetCore.Identity
@using RelevanceSiteStudyProject.Data
@inject SignInManager<User> SignInManager
@inject NavigationManager Navigation

<h3>Logging out...</h3>

<noscript>
    <meta http-equiv="refresh" content="0; url=@redirectUrl" />
</noscript>

<script>
    window.location.href = '@redirectUrl';
</script>


@code {

    [SupplyParameterFromQuery]
    private string? returnUrl { get; set; }

    private string redirectUrl = "/";

    protected override async Task OnInitializedAsync()
    {
        await SignInManager.SignOutAsync();

        if (!string.IsNullOrEmpty(returnUrl))
        {
            if (IsOkURL(returnUrl))
            {
                redirectUrl = returnUrl;
            }
            else
            {
                redirectUrl = Navigation.BaseUri;
            }
        }
    }

    private bool IsOkURL(string? url)
    {
        return !string.IsNullOrEmpty(url) && url.StartsWith(Navigation.BaseUri);
    }

}
